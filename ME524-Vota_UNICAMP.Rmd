---
title: "Pojeto ME524 - Vota UNICAMP"
author: 'Nara Stefani, Ricardo Corder, Robson Borges, Rodrigo Fadel, Tomás Weguelin,
  Victória Angeli e Vinícius Ota '
output: html_document
---
##Introdução 
Nos últimos meses, a Universidade Estadual de Campinas (UNICAMP) foi tomada pelo movimento grevista, que protesta contra o anúncio de corte de verbas, por um programa de cotas étnico-raciais e permanência estudantil.
Em cada instituto, são realizadas assembleias estudantis, nas quais os alunos votam a favor ou conta a greve. Entretanto, muitos não conseguem participar. Essa falta de adesão gera vários questionamentos sobre a representatividade desses votos. Para isso, foi criado o site [votaunicamp](https://votaunicamp.herokuapp.com/), uma plataforma independente com o objetivo de tornar mais acessíveis o voto e as informações oferecer um complemento democrático às assembleias da UNICAMP.
Neste site, é possível colocar para votação aberta as pautas colocadas nas assembleias e postar opiniões e argumentos sobre os temas em pauta. Além disso, os usuários podem alterar seu votos: basta votar novamente e o voto anterior será alterado. Apenas alunos da UNICAMP podem votar.

##Objetivo
Este trabalho tem como objetivo analisar estatisticamente sob diferentes ângulos os resultados presentes no já citado site *Vota* *UNICAMP*. O principal tópico a ser analisado é a comparação dos comportamentos dos estudantes de diferentes institutos e áreas de atuação (exatas, humanas ou biológicas) com relação ao posicionamento em relação à greve. Para isso, serão utilizados procedimentos estatísticos como testes de hipóteses e intervalos de confiança, além de gráficos, para melhor visualização dos dados, a serem mais detalhadamente explicados posteriormente.


```{r input, message=FALSE, warning=FALSE, echo=F, include=F}
#setup
library(stringr)
library(rvest)
library(googleVis)
library(leaflet)
page=read_html('https://votaunicamp.herokuapp.com/prev_results/')
tbl=html_table(page)[[2]]
head(tbl)
```


```{r format,warning=F,echo=F,include=F}
## Formatação de Dados
mytbl = data.frame(codigo=as.integer(str_extract(tbl$Curso, "^\\d+")),
                   nivel=NA,
                   curso=gsub("^(\\d+) - (.*)$", "\\2", tbl$Curso),
                   total=tbl$Total,
                   sim=as.integer(str_extract(tbl$Sim, "^\\d+")),
                   nao=as.integer(str_extract(tbl$Não, "^\\d+")),
                   abstencao=as.integer(str_extract(tbl$Abstenções, "^\\d+")))
nivel = str_extract(mytbl$curso, "(Dou|Mes)[a-z]+")
nivel[grepl("Mes", nivel)] = "Mestrado"
nivel[grepl("Dou", nivel)] = "Doutorado"
nivel[is.na(nivel)] = "Graduacao"
mytbl$nivel = nivel
rm(nivel)
mytbl$curso = gsub("(Mes|Dou).+ em (.*)$", "\\2", mytbl$curso)
head(mytbl)
```

Para nossa análise, utilizamos a seguinte tabela:

```{r warning=F,echo=F,include=F}
institutos = rbind(data.frame(instituto='IMECC', codigo=c(1,2,28,29,51)),
                   data.frame(instituto='FEM', codigo=c(10,49)),
                   data.frame(instituto='FCA', codigo=c(100,101,102,105,107,109)),
                   data.frame(instituto='IFGW', codigo=c(108,4,40,56)),
                   data.frame(instituto='FEEC', codigo=c(11,41)),
                   data.frame(instituto='FEC', codigo=c(12,48)),
                   data.frame(instituto='FOP', codigo=14),
                   data.frame(instituto='FEA', codigo=c(13,43)),
                   data.frame(instituto='FCM', codigo=c(15,58,63)),
                   data.frame(instituto='IFCH', codigo=c(16,19,44)),
                   data.frame(instituto='IE', codigo=c(17,47)),
                   data.frame(instituto='IEL', codigo=c(18,7,75)),
                   data.frame(instituto='IA', codigo=c(22,26,64)),
                   data.frame(instituto='FEF', codigo=c(27,45)),
                   data.frame(instituto='IC', codigo=c(34,42,3)),
                   data.frame(instituto='FEQ', codigo=c(39,9)),
                   data.frame(instituto='IB', codigo=c(46,6)),
                   data.frame(instituto='IQ', codigo=c(5,50)),
                   data.frame(instituto='IG', codigo=c(53,55)),
                   data.frame(instituto='FEAGRI', codigo=8),
                   data.frame(instituto='FE', codigo=38),
                   data.frame(instituto='Outros', codigo=c(98,92,83)))

```

```{r warning=F,echo=F,include=F}
#Vamos mudar a aprensentação dos dados na tabela
mytbl = merge(mytbl, institutos)
mytbl = subset(mytbl, nivel=='Graduacao')
head(mytbl)
```

```{r warning=F,echo=F,include=F}
area = rbind( data.frame(area='Exatas', codigo=c(1,2,28,29,51,10,49,108,4,40,56,11,41,
                                                 12,48,13,43,34,42,3,39,9,5,50,53,55,8)),
              data.frame(area='Humanas', codigo=c(16,19,44,17,47,18,7,75,22,26,64,38)),
              data.frame(area='Biologicas',codigo=c(100,101,102,105,107,109,14,15,58,63,27,
                                                    45,46,6)),
              data.frame(area='Outros', codigo=c(98,92,83)))
```

```{r warning=F,echo=F,include=F}
#Vamos mudar a aprensentação dos dados na tabela incluindo as classificações de áreas .
mytbl = merge(mytbl, area)
mytbl = subset(mytbl, nivel=='Graduacao')
head(mytbl)
```

```{r, echo=FALSE}
library(knitr)
kable(mytbl)
```

```{r warning=F, include=FALSE}
#total de sim por institutp
totsim=tapply(mytbl$sim,mytbl$instituto,sum)
#total de votos de cada instituo
totalinst=tapply(mytbl$total,mytbl$instituto,sum)
#proporção de sim
propsim=round(totsim/totalinst,digits = 2)

#total de não por instituto
totnao=tapply(mytbl$nao,mytbl$instituto,sum)
#usaremos o total de votos no instituto,já calculado anteriormente com nome totalinst
propnao=round(totnao/totalinst,digits=2)
#total de abstenção por instituto
totabs=tapply(mytbl$abstencao,mytbl$instituto,sum)
#proporção de abstenção
propabs=round(totabs/totalinst,digits = 2)

tabelaproporcaosim=data.frame(propsim)
tabelaproporcaonao=data.frame(propnao)
tabelaproporcaoabstencao=data.frame(propabs)
tabelafinal=cbind(tabelaproporcaosim,tabelaproporcaonao,tabelaproporcaoabstencao)
```

## Gauge Plots

```{r plot_gauge,warning=F,echo=F,include=F}
tbl0 = subset(mytbl, nivel=='Graduacao')
tbl0$pnao = round(tbl0$nao/tbl0$total*100, 0)
gauge = gvisGauge(tbl0[, c('curso', 'pnao')], 'curso', 'nao',
                  options=list(min=0, max=100, greenFrom=0,
                                 greenTo=20, yellowFrom=40, yellowTo=60,
                                 redFrom=80, redTo=100, width=400, height=300))
```


```{r}
plot(gauge)
```

## Obtenção de Dados Geográficos

```{r enderecos,warning=F,echo=F,include=F}
ends = data.frame(instituto=c('IMECC', 'FEM','FEF', 'IA', 'IEL', 'IFCH', 'IFGW', 'IQ',
                              'IB', 'FEEC', 'FEQ', 'FE', 'IE', 'IC', 'FEC', 'FEAGRI',
                              'FCM','IG', 'FEA'),
           lat=c(-22.81583, -22.81938, -22.81476, -22.815127, -22.815121, -22.814924, 
                 -22.816778, -22.818993, -22.819333, -22.821286, -22.820336, -22.816466, 
                 -22.814952, -22.814663, -22.816503, -22.819405, -22.831345, -22.813084,
                 -22.820475),
           lon=c(-47.06769,-47.06592,-47.07333,-47.070112, -47.069397, -47.068303,
                 -47.067328, -47.068038, -47.069402, -47.065894, -47.065617, -47.065728,
                 -47.066153, -47.064811, -47.061943, -47.060955, -47.062188, -47.068574,
                 -47.067189))
```

```{r, echo=FALSE}
map = leaflet()
map = addTiles(map)
map = addCircleMarkers(map, lat=ends$lat, lng=ends$lon, popup = ends$instituto)
map
```



## Tamanho Mínimo da Amostra

Nesta etapa buscamos encontrar um tamanho mínimo de amostra para estimar a proporção de SIM e de NÃO,tanto para o número total de estudantes da Unicamp, quanto para o total de alunos do Imecc. Buscamos assim ter um número para indicar um quórum mínimo paras as assembléias realizadas na Universidade para que estas sejam realmente representativas.

```{r tam_amostras}
#Amostra para o Imecc
Total_Imecc<-1029
EMM_Imecc<-seq(from= 0.01, to=0.05, by=0.01)
Z_Alpha_Imecc<-1.96
N_Imecc<- Total_Imecc/((4*(Total_Imecc-1)*((EMM_Imecc)^2/(Z_Alpha_Imecc)^2)+1))

#Amostra para total da Unicamp
Total_Unicamp<- 13312
EMM_Unicamp<-seq(from= 0.01, to=0.05, by=0.01)
Z_Alpha_Unicamp<-1.96
N_Unicamp<- Total_Unicamp/((4*(Total_Unicamp-1)*((EMM_Unicamp)^2/(Z_Alpha_Unicamp)^2)+1))
```

## Intervalos de Confiança

```{r stats, echo=FALSE}
#Intervalo de confiança para os votos do IMECC

#Tabela para os cursos caracterizados como IMECC
votosImecc = subset(mytbl, mytbl$instituto=="IMECC")
TotalT = sum(votosImecc$total) #total de votos 
PropSim = with(votosImecc, sum(sim)/sum(total))#Proporção de voto sim
PropNao = with(votosImecc, sum(nao)/sum(total))#proporção de voto não
PropAbs = with(votosImecc, sum(abstencao)/sum(total))#proporção de abstebnções

#Ic para a proporção de votos Sim no IMECC
mes = qnorm(.975)*sqrt(1/(4*TotalT))
icSim = cbind(pmax(PropSim-mes, 0), pmin(PropSim+mes, 1))

#Ic para a proporção de votos Não no IMECC
mes = qnorm(.975)*sqrt(1/(4*TotalT))
icNao = cbind(pmax(PropNao-mes, 0), pmin(PropNao+mes, 1))

#Ic para a proporção de abstenção no IMECC
mes = qnorm(.975)*sqrt(1/(4*TotalT))
icAbs = cbind(pmax(PropAbs-mes, 0), pmin(PropAbs+mes, 1))
```

Fazendo os Intervalos de confiança para a proporção de votos do IMECC, esperamos que:
- A proporção de sim esteja 95% das vezes nesse intervalo: `r icSim`.
- A proporção de não esteja 95% das vezes nesse intervalo: `r icNao`.
- A proporção de abstenções esteja 95% das vezes nesse intervalo: `r icAbs`.

```{r, echo=FALSE}
#Intervalo de confiança para os votos dos cursos da área de Exatas 

#tabela apenas para os cursos categorizados como Exatas
VotosExatas = subset(mytbl, mytbl$area=="Exatas")
TotalT = sum(VotosExatas$total)#total de votos
PropSim = with(VotosExatas, sum(sim)/sum(total))#proporção de votos sim 
PropNao = with(VotosExatas, sum(nao)/sum(total))#proporção de votos não
PropAbs = with(votosImecc, sum(abstencao)/sum(total))#proporção de abstenção

#Ic para a proporção de votos Sim no IMECC
mes = qnorm(.975)*sqrt(1/(4*TotalT))
icSim = cbind(pmax(PropSim-mes, 0), pmin(PropSim+mes, 1))

#Ic para a proporção de votos Não no IMECC
mes = qnorm(.975)*sqrt(1/(4*TotalT))
icNao = cbind(pmax(PropNao-mes, 0), pmin(PropNao+mes, 1))

#Ic para a proporção de abstenção no IMECC
mes = qnorm(.975)*sqrt(1/(4*TotalT))
icAbs = cbind(pmax(PropAbs-mes, 0), pmin(PropAbs+mes, 1))
```

Fazendo os Intervalos de confiança para os cursos da área de Exatas, esperamos que:
- A proporção de sim esteja 95% das vezes nesse intervalo: `r icSim`.
- A proporção de não esteja 95% das vezes nesse intervalo: `r icNao`.
- A proporção de abstenções esteja 95% das vezes nesse intervalo: `r icAbs`.

```{r, echo=FALSE}
#Intervalo de confiança para os votos dos cursos da área de biológicas

#Tabela para os cursos caracterizados da área de biológicas
VotosBiologicas = subset(mytbl, mytbl$area=="Biologicas")
TotalT = sum(VotosBiologicas$total) #total de votos 
PropSim = with(VotosBiologicas, sum(sim)/sum(total))#Proporção de voto sim
PropNao = with(VotosBiologicas, sum(nao)/sum(total))#proporção de voto não
PropAbs = with(VotosBiologicas, sum(abstencao)/sum(total))#proporção de abstebnções

#Ic para a proporção de votos Sim da área de biológicas 
mes = qnorm(.975)*sqrt(1/(4*TotalT))
icSim = cbind(pmax(PropSim-mes, 0), pmin(PropSim+mes, 1))

#Ic para a proporção de votos Não da área de biológicas
mes = qnorm(.975)*sqrt(1/(4*TotalT))
icNao = cbind(pmax(PropNao-mes, 0), pmin(PropNao+mes, 1))

#Ic para a proporção de abstenção da área de biológicas
mes = qnorm(.975)*sqrt(1/(4*TotalT))
icAbs = cbind(pmax(PropAbs-mes, 0), pmin(PropAbs+mes, 1))

```

Fazendo os Intervalos de confiança para os cursos da área de Biológicas, esperamos que:
- A proporção de sim esteja 95% das vezes nesse intervalo: `r icSim`.

- A proporção de não esteja 95% das vezes nesse intervalo: `r icNao`.

- A proporção de abstenções esteja 95% das vezes nesse intervalo: `r icAbs`.

```{r, echo=FALSE}
#Intervalo de confiança para os votos dos cursos da área de humanas

#Tabela para os cursos caracterizados da área de humanas
VotosHumanas = subset(mytbl, mytbl$area=="Humanas")
TotalT = sum(VotosHumanas$total) #total de votos 
PropSim = with(VotosHumanas, sum(sim)/sum(total))#Proporção de voto sim
PropNao = with(VotosHumanas, sum(nao)/sum(total))#proporção de voto não
PropAbs = with(VotosHumanas, sum(abstencao)/sum(total))#proporção de abstebnções

#Ic para a proporção de votos Sim da área de humanas 
mes = qnorm(.975)*sqrt(1/(4*TotalT))
icSim = cbind(pmax(PropSim-mes, 0), pmin(PropSim+mes, 1))

#Ic para a proporção de votos Não da área de humanas
mes = qnorm(.975)*sqrt(1/(4*TotalT))
icNao = cbind(pmax(PropNao-mes, 0), pmin(PropNao+mes, 1))

#Ic para a proporção de abstenção da área de humanas
mes = qnorm(.975)*sqrt(1/(4*TotalT))
icAbs = cbind(pmax(PropAbs-mes, 0), pmin(PropAbs+mes, 1))

```

Fazendo os Intervalos de confiança para os cursos da área de Humanas, esperamos que:
- A proporção de sim esteja 95% das vezes nesse intervalo: `r icSim`.
- A proporção de não esteja 95% das vezes nesse intervalo: `r icNao`.
- A proporção de abstenções esteja 95% das vezes nesse intervalo: `r icAbs`.
